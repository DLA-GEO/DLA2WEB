<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Licenciamento Ambiental - Estado do Pará</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.ZoomBar.css"/>
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/MarkerCluster.css">
    <link rel="stylesheet" href="css/MarkerCluster.Default.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">        
    <link rel="stylesheet" href="css/leaflet_expressions.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            padding: 25px 0;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        
        .header-content {
            padding: 0 20px;
        }
        
        h1 {
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        h1 i {
            font-size: 36px;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-title {
            font-size: 22px;
            font-weight: 700;
            color: #2c5530;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-panel {
            background: linear-gradient(135deg, #ffffff 0%, #f8fdf9 100%);
            border-left: 5px solid #4a7c59;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c5530;
            font-size: 15px;
        }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        input:focus, select:focus {
            border-color: #4a7c59;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%);
            color: white;
            border: none;
            padding: 16px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(44, 85, 48, 0.3);
        }
        
        .secondary-button {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .secondary-button:hover {
            box-shadow: 0 6px 15px rgba(108, 117, 125, 0.3);
        }
        
        .map-container {
            height: 550px;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #e8f5e9;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            white-space: nowrap;
        }
        
        th {
            background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%);
            color: white;
            font-weight: 600;
            font-size: 15px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:nth-child(even) {
            background-color: #f9fdfa;
        }
        
        tr:hover {
            background-color: #e8f5e9;
            transform: scale(1.01);
            transition: all 0.2s;
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            min-width: 120px;
        }
        
        .status-active {
            background-color: #e6f7ee;
            color: #00a65a;
            border: 1px solid #00a65a;
        }
        
        .status-pending {
            background-color: #fef5e6;
            color: #f39c12;
            border: 1px solid #f39c12;
        }
        
        .status-inactive {
            background-color: #fdeaea;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .results-info {
            margin-top: 15px;
            padding: 18px;
            background: linear-gradient(135deg, #e8f5e9 0%, #d0ebd7 100%);
            border-radius: 10px;
            border-left: 5px solid #4a7c59;
            font-size: 15px;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .file-upload {
            background: #f8fdf9;
            border: 2px dashed #4a7c59;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            background: #e8f5e9;
            border-color: #2c5530;
        }
        
        .file-upload i {
            font-size: 40px;
            color: #4a7c59;
            margin-bottom: 10px;
        }
        
        #file-name {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .coordinates-example {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .separator-info {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
            color: #2c5530;
            border: 1px solid #4a7c59;
        }
        
        .coordinate-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .coordinate-input {
            text-align: center;
        }
        
        .coordinate-input input {
            text-align: center;
            font-size: 14px;
        }
        
        .coordinate-label {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .coordinate-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .format-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .format-btn {
            flex: 1;
            padding: 10px;
            background: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .format-btn.active {
            background: #4a7c59;
            color: white;
            border-color: #2c5530;
        }
        
        .search-type-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-type-btn {
            flex: 1;
            padding: 12px;
            background: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .search-type-btn.active {
            background: #4a7c59;
            color: white;
            border-color: #2c5530;
        }
        
        .search-section {
            display: none;
        }
        
        .search-section.active {
            display: block;
        }
        
        .process-example {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .coordinate-input-group {
                grid-template-columns: 1fr;
            }
            
            .search-type-toggle {
                flex-direction: column;
            }
            
            .table-container {
                max-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .table-container {
                max-height: 350px;
            }
            
            th, td {
                padding: 10px 8px;
                font-size: 14px;
            }
            
            .status-badge {
                min-width: 100px;
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-tree"></i> Licenciamento Ambiental - Estado do Pará</h1>
                <p class="subtitle">Sistema de Monitoramento de Empreendimentos</p>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="card search-panel">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-search"></i> Busca Avançada</h3>
                </div>
                
                <div class="separator-info">
                    <i class="fas fa-info-circle"></i> O sistema aceita apenas arquivos CSV com separador de ponto e vírgula (;)
                </div>
                
                <div class="file-upload" id="file-upload-area">
                    <i class="fas fa-file-csv"></i>
                    <p><strong>Clique para carregar arquivo CSV</strong></p>
                    <p>ou arraste o arquivo para esta área</p>
                    <p id="file-name">Nenhum arquivo selecionado</p>
                    <input type="file" id="csv-file" accept=".csv" style="display: none;">
                </div>
                
                <div class="search-type-toggle">
                    <div class="search-type-btn active" data-search-type="coordinates">
                        <i class="fas fa-map-marker-alt"></i> Por Coordenadas
                    </div>
                    <div class="search-type-btn" data-search-type="process">
                        <i class="fas fa-file-alt"></i> Por Processo
                    </div>
                </div>
                
                <!-- Seção de Busca por Coordenadas -->
                <div class="search-section active" id="coordinates-search">
                    <div class="format-toggle">
                        <div class="format-btn active" data-format="gms">Graus/Minutos/Segundos</div>
                        <div class="format-btn" data-format="decimal">Decimal</div>
                    </div>
                    
                    <div class="form-group" id="latitude-gms-group">
                        <label for="latitude"><i class="fas fa-globe-americas"></i> Latitude</label>
                        <div class="coordinate-input-group">
                            <div class="coordinate-input">
                                <input type="number" id="lat-degrees" placeholder="Graus" min="-90" max="90" value="5">
                                <div class="coordinate-label">Graus (°)</div>
                            </div>
                            <div class="coordinate-input">
                                <input type="number" id="lat-minutes" placeholder="Minutos" min="0" max="59" value="31">
                                <div class="coordinate-label">Minutos (')</div>
                            </div>
                            <div class="coordinate-input">
                                <input type="number" id="lat-seconds" placeholder="Segundos" min="0" max="59.999" step="0.001" value="58.32">
                                <div class="coordinate-label">Segundos (")</div>
                            </div>
                        </div>
                        <select id="lat-direction">
                            <option value="-1">Sul (S)</option>
                            <option value="1">Norte (N)</option>
                        </select>
                        <div class="coordinate-display" id="lat-decimal-display">
                            Decimal: -5.5327°
                        </div>
                    </div>
                    
                    <div class="form-group" id="longitude-gms-group">
                        <label for="longitude"><i class="fas fa-globe-americas"></i> Longitude</label>
                        <div class="coordinate-input-group">
                            <div class="coordinate-input">
                                <input type="number" id="lon-degrees" placeholder="Graus" min="-180" max="180" value="52">
                                <div class="coordinate-label">Graus (°)</div>
                            </div>
                            <div class="coordinate-input">
                                <input type="number" id="lon-minutes" placeholder="Minutos" min="0" max="59" value="17">
                                <div class="coordinate-label">Minutos (')</div>
                            </div>
                            <div class="coordinate-input">
                                <input type="number" id="lon-seconds" placeholder="Segundos" min="0" max="59.999" step="0.001" value="31.92">
                                <div class="coordinate-label">Segundos (")</div>
                            </div>
                        </div>
                        <select id="lon-direction">
                            <option value="-1">Oeste (W)</option>
                            <option value="1">Leste (E)</option>
                        </select>
                        <div class="coordinate-display" id="lon-decimal-display">
                            Decimal: -52.2922°
                        </div>
                    </div>
                    
                    <div class="form-group" id="latitude-decimal-group" style="display: none;">
                        <label for="latitude-decimal"><i class="fas fa-globe-americas"></i> Latitude (Decimal)</label>
                        <input type="text" id="latitude-decimal" placeholder="Ex: -5.5327">
                    </div>
                    
                    <div class="form-group" id="longitude-decimal-group" style="display: none;">
                        <label for="longitude-decimal"><i class="fas fa-globe-americas"></i> Longitude (Decimal)</label>
                        <input type="text" id="longitude-decimal" placeholder="Ex: -52.2922">
                    </div>
                    
                    <div class="form-group">
                        <label for="radius"><i class="fas fa-ruler-combined"></i> Raio de Busca (km)</label>
                        <input type="number" id="radius" placeholder="Ex: 50" value="50" min="1" max="500">
                    </div>
                    
                    <button id="search-coordinates-btn">
                        <i class="fas fa-search"></i> Buscar por Coordenadas
                    </button>
                </div>
                
                <!-- Seção de Busca por Processo -->
                <div class="search-section" id="process-search">
                    <div class="form-group">
                        <label for="process-number"><i class="fas fa-file-contract"></i> Número do Processo</label>
                        <input type="text" id="process-number" placeholder="Ex: 2022/0000009426" maxlength="15">
                        <div class="process-example">Formato: AAAA/NNNNNNNNNN (15 caracteres máximo)</div>
                    </div>
                    
                    <button id="search-process-btn" class="secondary-button">
                        <i class="fas fa-search"></i> Buscar por Processo
                    </button>
                    
                    <div class="results-info">
                        <p><i class="fas fa-info-circle"></i> Digite o número completo do processo para localizar o empreendimento específico.</p>
                    </div>
                </div>
                
                <button id="show-all-btn" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); margin-top: 15px;">
                    <i class="fas fa-list"></i> Mostrar Todos os Empreendimentos
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-map-marked-alt"></i> Mapa de Empreendimentos</h3>
                </div>
                <div class="map-container" id="map"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2ecc71;"></div>
                        <span>Dentro do Raio/Encontrado</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e74c3c;"></div>
                        <span>Fora do Raio/Não Encontrado</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #3498db;"></div>
                        <span>Coordenada de Busca</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f39c12;"></div>
                        <span>Capital (Belém)</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-list-ul"></i> Empreendimentos Encontrados</h3>
                <span id="results-count">0 resultados</span>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Empreendimento</th>
                            <th>Processo</th>
                            <th>Situação</th>
                            <th>Localização</th>
                            <th>Título</th>
                            <th>Distância (km)</th>
                        </tr>
                    </thead>
                    <tbody id="results-table">
                        <tr>
                            <td colspan="6" style="text-align: center;">Carregue um arquivo CSV e realize uma busca para visualizar os resultados</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Scripts do qgis2web -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/multi-style-layer.js"></script>
    <script src="js/leaflet-svg-shape-markers.min.js"></script>
    <script src="js/L.Control.ZoomBar.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet.photon.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap-tpls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/js/bootstrap.bundle.min.js" integrity="sha512-HvOjJrdwNpDbkGJIG2ZNqDlVqMo77qbs4Me4cah0HoDrfhrbA+8SBlZn1KrvAQw7cILLPFJvdwIgphzQmMm+Pw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    
    <!-- Dados das camadas temáticas -->
    <script src="data/UCMunicipalMMA_3.js"></script>
    <script src="data/UCEstadual_4.js"></script>
    <script src="data/UCFederal_5.js"></script>
    <script src="data/reaMinlitar_6.js"></script>
    <script src="data/TerrasIndigenas_7.js"></script>
    <script src="data/AldeiasIndigenas_8.js"></script>
    <script src="data/QuilomboEstadual_9.js"></script>
    <script src="data/QuilomboFederal_10.js"></script>
    <script src="data/RodoviaEstadual_11.js"></script>
    <script src="data/RodoviaFederal_12.js"></script>
    <script src="data/SedesMunicpios_13.js"></script>
    <script src="data/Capital_14.js"></script>
    <script src="data/FronteiraMunicipal_15.js"></script>

    <script>
        // Variáveis globais para o aplicativo
        let empreendimentos = [];
        let markers = [];
        let map; // Variável global para o mapa

        // Inicialização do mapa qgis2web
        function initializeQgis2webMap() {
            var highlightLayer;
            function highlightFeature(e) {
                highlightLayer = e.target;
                highlightLayer.openPopup();
            }
            
            // Inicializar o mapa
            map = L.map('map', {
                zoomControl:false, 
                maxZoom:28, 
                minZoom:6
            }).fitBounds([[-10.612797174589554,-60.008087739307456],[2.488037768410446,-44.88672601405379]]);
            
            var hash = new L.Hash(map);
            map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
            var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
            
            // remove popup's row if "visible-with-data"
            function removeEmptyRowsFromPopupContent(content, feature) {
                var tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                var rows = tempDiv.querySelectorAll('tr');
                for (var i = 0; i < rows.length; i++) {
                    var td = rows[i].querySelector('td.visible-with-data');
                    var key = td ? td.id : '';
                    if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                        rows[i].parentNode.removeChild(rows[i]);
                    }
                }
                return tempDiv.innerHTML;
            }
            
            // add class to format popup if it contains media
            function addClassToPopupIfMedia(content, popup) {
                var tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                if (tempDiv.querySelector('td img')) {
                    popup._contentNode.classList.add('media');
                    // Delay to force the redraw
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            }
            
            var title = new L.Control({'position':'topleft'});
            title.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            title.update = function () {
                this._div.innerHTML = '<h2>-Licenciamento Ambiental - Estado do Pará-</h2>';
            };
            title.addTo(map);
            
            var abstract = new L.Control({'position':'bottomleft'});
            abstract.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'leaflet-control abstract');
                this._div.id = 'abstract'
                abstract.show();
                return this._div;
            };
            abstract.show = function () {
                this._div.classList.remove("abstract");
                this._div.classList.add("abstractUncollapsed");
                this._div.innerHTML = 'DISTRIBUTION OF MINING LICENSING IN THE STATE OF PARÁ<br />Application, Research and Mining.';
            };
            abstract.addTo(map);
            
            var zoomControl = L.control.zoom({
                position: 'topleft'
            }).addTo(map);
            
            var measureControl = new L.Control.Measure({
                position: 'topleft',
                primaryLengthUnit: 'meters',
                secondaryLengthUnit: 'kilometers',
                primaryAreaUnit: 'sqmeters',
                secondaryAreaUnit: 'hectares'
            });
            measureControl.addTo(map);
            document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
            document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
            
            var bounds_group = new L.featureGroup([]);
            
            function setBounds() {
                map.setMaxBounds(map.getBounds());
                map.setMinZoom(map.getZoom());
            }
            
            // Camadas base
            map.createPane('pane_OSMHybrid_0');
            map.getPane('pane_OSMHybrid_0').style.zIndex = 400;
            var layer_OSMHybrid_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
                pane: 'pane_OSMHybrid_0',
                opacity: 1.0,
                attribution: '<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Map data ©2015 Google</a>',
                minZoom: 5,
                maxZoom: 28,
                minNativeZoom: 0,
                maxNativeZoom: 20
            });
            map.addLayer(layer_OSMHybrid_0);
            
            map.createPane('pane_OpenTopoMap_1');
            map.getPane('pane_OpenTopoMap_1').style.zIndex = 401;
            var layer_OpenTopoMap_1 = L.tileLayer('https://a.tile.opentopomap.org/{z}/{x}/{y}.png', {
                pane: 'pane_OpenTopoMap_1',
                opacity: 1.0,
                attribution: '<a href="https://www.openstreetmap.org/copyright">Kartendaten: © OpenStreetMap-Mitwirkende, SRTM | Kartendarstellung: © OpenTopoMap (CC-BY-SA)</a>',
                minZoom: 5,
                maxZoom: 28,
                minNativeZoom: 0,
                maxNativeZoom: 18
            });
            
            map.createPane('pane_OSMStandard_2');
            map.getPane('pane_OSMStandard_2').style.zIndex = 402;
            var layer_OSMStandard_2 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                pane: 'pane_OSMStandard_2',
                opacity: 1.0,
                attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
                minZoom: 5,
                maxZoom: 28,
                minNativeZoom: 0,
                maxNativeZoom: 19
            });
            
            // [Todas as funções das camadas temáticas permanecem aqui...]
            // UC Municipal MMA
            function pop_UCMunicipalMMA_3(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">Nome U.C.</th>\
                            <td>' + (feature.properties['nomeUc'] !== null ? autolinker.link(String(feature.properties['nomeUc']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_UCMunicipalMMA_3_0() {
                return {
                    pane: 'pane_UCMunicipalMMA_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(125,139,143,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_UCMunicipalMMA_3');
            map.getPane('pane_UCMunicipalMMA_3').style.zIndex = 403;
            map.getPane('pane_UCMunicipalMMA_3').style['mix-blend-mode'] = 'normal';
            var layer_UCMunicipalMMA_3 = new L.geoJson(json_UCMunicipalMMA_3, {
                attribution: '',
                interactive: true,
                dataVar: 'json_UCMunicipalMMA_3',
                layerName: 'layer_UCMunicipalMMA_3',
                pane: 'pane_UCMunicipalMMA_3',
                onEachFeature: pop_UCMunicipalMMA_3,
                style: style_UCMunicipalMMA_3_0,
            });
            bounds_group.addLayer(layer_UCMunicipalMMA_3);

            // [As demais funções das camadas permanecem iguais...]
            // UC Estadual
            function pop_UCEstadual_4(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">Sigla</th>\
                            <td>' + (feature.properties['sigla'] !== null ? autolinker.link(String(feature.properties['sigla']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Copentência</th>\
                            <td>' + (feature.properties['siglaGrup'] !== null ? autolinker.link(String(feature.properties['siglaGrup']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Ano de Criação</th>\
                            <td>' + (feature.properties['anoCriaca'] !== null ? autolinker.link(String(feature.properties['anoCriaca']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Nome U.C.</th>\
                            <td>' + (feature.properties['nome'] !== null ? autolinker.link(String(feature.properties['nome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_UCEstadual_4_0() {
                return {
                    pane: 'pane_UCEstadual_4',
                    opacity: 1,
                    color: 'rgba(148,204,126,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(190,207,80,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_UCEstadual_4');
            map.getPane('pane_UCEstadual_4').style.zIndex = 404;
            map.getPane('pane_UCEstadual_4').style['mix-blend-mode'] = 'normal';
            var layer_UCEstadual_4 = new L.geoJson(json_UCEstadual_4, {
                attribution: '',
                interactive: true,
                dataVar: 'json_UCEstadual_4',
                layerName: 'layer_UCEstadual_4',
                pane: 'pane_UCEstadual_4',
                onEachFeature: pop_UCEstadual_4,
                style: style_UCEstadual_4_0,
            });
            bounds_group.addLayer(layer_UCEstadual_4);

            // [Continuação das outras camadas...]
            // UC Federal
            function pop_UCFederal_5(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">nome</th>\
                            <td>' + (feature.properties['nome'] !== null ? autolinker.link(String(feature.properties['nome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Sigla</th>\
                            <td>' + (feature.properties['sigla'] !== null ? autolinker.link(String(feature.properties['sigla']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Grupo</th>\
                            <td>' + (feature.properties['siglaGrupo'] !== null ? autolinker.link(String(feature.properties['siglaGrupo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_UCFederal_5_0() {
                return {
                    pane: 'pane_UCFederal_5',
                    opacity: 1,
                    color: 'rgba(121,168,4,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(148,204,48,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_UCFederal_5');
            map.getPane('pane_UCFederal_5').style.zIndex = 405;
            map.getPane('pane_UCFederal_5').style['mix-blend-mode'] = 'normal';
            var layer_UCFederal_5 = new L.geoJson(json_UCFederal_5, {
                attribution: '',
                interactive: true,
                dataVar: 'json_UCFederal_5',
                layerName: 'layer_UCFederal_5',
                pane: 'pane_UCFederal_5',
                onEachFeature: pop_UCFederal_5,
                style: style_UCFederal_5_0,
            });
            bounds_group.addLayer(layer_UCFederal_5);

            // [As demais camadas continuam da mesma forma...]
            // Área Militar
            function pop_reaMinlitar_6(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">NOME</th>\
                            <td>' + (feature.properties['NOME'] !== null ? autolinker.link(String(feature.properties['NOME']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_reaMinlitar_6_0() {
                return {
                    pane: 'pane_reaMinlitar_6',
                    opacity: 1,
                    color: 'rgba(149,113,113,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(190,178,151,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_reaMinlitar_6');
            map.getPane('pane_reaMinlitar_6').style.zIndex = 406;
            map.getPane('pane_reaMinlitar_6').style['mix-blend-mode'] = 'normal';
            var layer_reaMinlitar_6 = new L.geoJson(json_reaMinlitar_6, {
                attribution: '',
                interactive: true,
                dataVar: 'json_reaMinlitar_6',
                layerName: 'layer_reaMinlitar_6',
                pane: 'pane_reaMinlitar_6',
                onEachFeature: pop_reaMinlitar_6,
                style: style_reaMinlitar_6_0,
            });
            bounds_group.addLayer(layer_reaMinlitar_6);

            // Terras Indígenas
            function pop_TerrasIndigenas_7(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <td colspan="2"><strong>Nome</strong><br />' + (feature.properties['terraiNom'] !== null ? autolinker.link(String(feature.properties['terraiNom']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2"><strong>Etnia</strong><br />' + (feature.properties['etniaNome'] !== null ? autolinker.link(String(feature.properties['etniaNome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_TerrasIndigenas_7_0() {
                return {
                    pane: 'pane_TerrasIndigenas_7',
                    opacity: 1,
                    color: 'rgba(182,182,90,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(218,218,134,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_TerrasIndigenas_7');
            map.getPane('pane_TerrasIndigenas_7').style.zIndex = 407;
            map.getPane('pane_TerrasIndigenas_7').style['mix-blend-mode'] = 'normal';
            var layer_TerrasIndigenas_7 = new L.geoJson(json_TerrasIndigenas_7, {
                attribution: '',
                interactive: true,
                dataVar: 'json_TerrasIndigenas_7',
                layerName: 'layer_TerrasIndigenas_7',
                pane: 'pane_TerrasIndigenas_7',
                onEachFeature: pop_TerrasIndigenas_7,
                style: style_TerrasIndigenas_7_0,
            });
            bounds_group.addLayer(layer_TerrasIndigenas_7);

            // Aldeias Indígenas
            function pop_AldeiasIndigenas_8(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">cod_aldeia</th>\
                            <td>' + (feature.properties['cod_aldeia'] !== null ? autolinker.link(String(feature.properties['cod_aldeia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">nome_aldei</th>\
                            <td>' + (feature.properties['nome_aldei'] !== null ? autolinker.link(String(feature.properties['nome_aldei']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['cod_ti'] !== null ? autolinker.link(String(feature.properties['cod_ti']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['cod_munici'] !== null ? autolinker.link(String(feature.properties['cod_munici']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['data_cadas'] !== null ? autolinker.link(String(feature.properties['data_cadas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['flag_ativo'] !== null ? autolinker.link(String(feature.properties['flag_ativo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['nome_cr'] !== null ? autolinker.link(String(feature.properties['nome_cr']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['nommunic'] !== null ? autolinker.link(String(feature.properties['nommunic']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['nomuf'] !== null ? autolinker.link(String(feature.properties['nomuf']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['undadm_cod'] !== null ? autolinker.link(String(feature.properties['undadm_cod']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['coord_lat'] !== null ? autolinker.link(String(feature.properties['coord_lat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['coord_long'] !== null ? autolinker.link(String(feature.properties['coord_long']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_AldeiasIndigenas_8_0() {
                return {
                    pane: 'pane_AldeiasIndigenas_8',
                    radius: 4.0,
                    opacity: 1,
                    color: 'rgba(61,128,53,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 2.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(84,176,74,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_AldeiasIndigenas_8');
            map.getPane('pane_AldeiasIndigenas_8').style.zIndex = 408;
            map.getPane('pane_AldeiasIndigenas_8').style['mix-blend-mode'] = 'normal';
            var layer_AldeiasIndigenas_8 = new L.geoJson(json_AldeiasIndigenas_8, {
                attribution: '',
                interactive: true,
                dataVar: 'json_AldeiasIndigenas_8',
                layerName: 'layer_AldeiasIndigenas_8',
                pane: 'pane_AldeiasIndigenas_8',
                onEachFeature: pop_AldeiasIndigenas_8,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_AldeiasIndigenas_8_0(feature));
                },
            });
            var cluster_AldeiasIndigenas_8 = new L.MarkerClusterGroup({showCoverageOnHover: false,
                spiderfyDistanceMultiplier: 2});
            cluster_AldeiasIndigenas_8.addLayer(layer_AldeiasIndigenas_8);
            bounds_group.addLayer(layer_AldeiasIndigenas_8);

            // Quilombo Estadual
            function pop_QuilomboEstadual_9(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">comunidade</th>\
                            <td>' + (feature.properties['comunidade'] !== null ? autolinker.link(String(feature.properties['comunidade']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_QuilomboEstadual_9_0() {
                return {
                    pane: 'pane_QuilomboEstadual_9',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(199,59,242,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_QuilomboEstadual_9');
            map.getPane('pane_QuilomboEstadual_9').style.zIndex = 409;
            map.getPane('pane_QuilomboEstadual_9').style['mix-blend-mode'] = 'normal';
            var layer_QuilomboEstadual_9 = new L.geoJson(json_QuilomboEstadual_9, {
                attribution: '',
                interactive: true,
                dataVar: 'json_QuilomboEstadual_9',
                layerName: 'layer_QuilomboEstadual_9',
                pane: 'pane_QuilomboEstadual_9',
                onEachFeature: pop_QuilomboEstadual_9,
                style: style_QuilomboEstadual_9_0,
            });
            bounds_group.addLayer(layer_QuilomboEstadual_9);

            // Quilombo Federal
            function pop_QuilomboFederal_10(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">nm_comunid</th>\
                            <td>' + (feature.properties['nm_comunid'] !== null ? autolinker.link(String(feature.properties['nm_comunid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">fase</th>\
                            <td>' + (feature.properties['fase'] !== null ? autolinker.link(String(feature.properties['fase']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">responsave</th>\
                            <td>' + (feature.properties['responsave'] !== null ? autolinker.link(String(feature.properties['responsave']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_QuilomboFederal_10_0() {
                return {
                    pane: 'pane_QuilomboFederal_10',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0, 
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(154,45,187,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_QuilomboFederal_10');
            map.getPane('pane_QuilomboFederal_10').style.zIndex = 410;
            map.getPane('pane_QuilomboFederal_10').style['mix-blend-mode'] = 'normal';
            var layer_QuilomboFederal_10 = new L.geoJson(json_QuilomboFederal_10, {
                attribution: '',
                interactive: true,
                dataVar: 'json_QuilomboFederal_10',
                layerName: 'layer_QuilomboFederal_10',
                pane: 'pane_QuilomboFederal_10',
                onEachFeature: pop_QuilomboFederal_10,
                style: style_QuilomboFederal_10_0,
            });
            bounds_group.addLayer(layer_QuilomboFederal_10);

            // Rodovia Estadual
            function pop_RodoviaEstadual_11(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['revestimen'] !== null ? autolinker.link(String(feature.properties['revestimen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">codTrechor</th>\
                            <td>' + (feature.properties['codTrechor'] !== null ? autolinker.link(String(feature.properties['codTrechor']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_RodoviaEstadual_11_0() {
                return {
                    pane: 'pane_RodoviaEstadual_11',
                    opacity: 1,
                    color: 'rgba(183,72,75,1.0)',
                    dashArray: '',
                    lineCap: 'square',
                    lineJoin: 'bevel',
                    weight: 1.0,
                    fillOpacity: 0,
                    interactive: true,
                }
            }
            map.createPane('pane_RodoviaEstadual_11');
            map.getPane('pane_RodoviaEstadual_11').style.zIndex = 411;
            map.getPane('pane_RodoviaEstadual_11').style['mix-blend-mode'] = 'normal';
            var layer_RodoviaEstadual_11 = new L.geoJson(json_RodoviaEstadual_11, {
                attribution: '',
                interactive: true,
                dataVar: 'json_RodoviaEstadual_11',
                layerName: 'layer_RodoviaEstadual_11',
                pane: 'pane_RodoviaEstadual_11',
                onEachFeature: pop_RodoviaEstadual_11,
                style: style_RodoviaEstadual_11_0,
            });
            bounds_group.addLayer(layer_RodoviaEstadual_11);

            // Rodovia Federal
            function pop_RodoviaFederal_12(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['revestimen'] !== null ? autolinker.link(String(feature.properties['revestimen']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                        <tr>\
                            <th scope="row">Sigla</th>\
                            <td>' + (feature.properties['codTrechor'] !== null ? autolinker.link(String(feature.properties['codTrechor']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_RodoviaFederal_12_0() {
                return {
                    pane: 'pane_RodoviaFederal_12',
                    opacity: 1,
                    color: 'rgba(225,89,137,1.0)',
                    dashArray: '',
                    lineCap: 'square',
                    lineJoin: 'bevel',
                    weight: 1.0,
                    fillOpacity: 0,
                    interactive: true,
                }
            }
            map.createPane('pane_RodoviaFederal_12');
            map.getPane('pane_RodoviaFederal_12').style.zIndex = 412;
            map.getPane('pane_RodoviaFederal_12').style['mix-blend-mode'] = 'normal';
            var layer_RodoviaFederal_12 = new L.geoJson(json_RodoviaFederal_12, {
                attribution: '',
                interactive: true,
                dataVar: 'json_RodoviaFederal_12',
                layerName: 'layer_RodoviaFederal_12',
                pane: 'pane_RodoviaFederal_12',
                onEachFeature: pop_RodoviaFederal_12,
                style: style_RodoviaFederal_12_0,
            });
            bounds_group.addLayer(layer_RodoviaFederal_12);

            // Sedes Municípios
            function pop_SedesMunicpios_13(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <th scope="row">Nome</th>\
                            <td>' + (feature.properties['nome'] !== null ? autolinker.link(String(feature.properties['nome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_SedesMunicpios_13_0() {
                return {
                    pane: 'pane_SedesMunicpios_13',
                    radius: 4.0,
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(243,166,178,1.0)',
                    interactive: true,
                }
            }
            map.createPane('pane_SedesMunicpios_13');
            map.getPane('pane_SedesMunicpios_13').style.zIndex = 413;
            map.getPane('pane_SedesMunicpios_13').style['mix-blend-mode'] = 'normal';
            var layer_SedesMunicpios_13 = new L.geoJson(json_SedesMunicpios_13, {
                attribution: '',
                interactive: true,
                dataVar: 'json_SedesMunicpios_13',
                layerName: 'layer_SedesMunicpios_13',
                pane: 'pane_SedesMunicpios_13',
                onEachFeature: pop_SedesMunicpios_13,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_SedesMunicpios_13_0(feature));
                },
            });
            bounds_group.addLayer(layer_SedesMunicpios_13);

            // Capital
            function pop_Capital_14(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
                var popupContent = '<table>\
                        <tr>\
                            <td colspan="2">' + (feature.properties['nome'] !== null ? autolinker.link(String(feature.properties['nome']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                        </tr>\
                    </table>';
                var content = removeEmptyRowsFromPopupContent(popupContent, feature);
                layer.on('popupopen', function(e) {
                    addClassToPopupIfMedia(content, e.popup);
                });
                layer.bindPopup(content, { maxHeight: 400 });
            }

            function style_Capital_14_0() {
                return {
                    pane: 'pane_Capital_14',
                    radius: 9.0,
                    opacity: 1,
                    color: 'rgba(0,0,0,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(255,255,255,1.0)',
                    interactive: false,
                }
            }
            function style_Capital_14_1() {
                return {
                    pane: 'pane_Capital_14',
                    radius: 1.96875,
                    opacity: 1,
                    color: 'rgba(0,0,0,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 2.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(0,0,0,1.0)',
                    interactive: false,
                }
            }
            map.createPane('pane_Capital_14');
            map.getPane('pane_Capital_14').style.zIndex = 414;
            map.getPane('pane_Capital_14').style['mix-blend-mode'] = 'normal';
            var layer_Capital_14 = new L.geoJson.multiStyle(json_Capital_14, {
                attribution: '',
                interactive: false,
                dataVar: 'json_Capital_14',
                layerName: 'layer_Capital_14',
                pane: 'pane_Capital_14',
                onEachFeature: pop_Capital_14,
                pointToLayers: [function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Capital_14_0(feature));
                },function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Capital_14_1(feature));
                },
            ]});
            bounds_group.addLayer(layer_Capital_14);

            // Fronteira Municipal
            function pop_FronteiraMunicipal_15(feature, layer) {
                layer.on({
                    mouseout: function(e) {
                        if (typeof layer.closePopup == 'function') {
                            layer.closePopup();
                        } else {
                            layer.eachLayer(function(feature){
                                feature.closePopup()
                            });
                        }
                    },
                    mouseover: highlightFeature,
                });
            }

            function style_FronteiraMunicipal_15_0() {
                return {
                    pane: 'pane_FronteiraMunicipal_15',
                    opacity: 1,
                    color: 'rgba(136,130,130,1.0)',
                    dashArray: '',
                    lineCap: 'round',
                    lineJoin: 'round',
                    weight: 2.0,
                    fillOpacity: 0,
                    interactive: false,
                }
            }
            map.createPane('pane_FronteiraMunicipal_15');
            map.getPane('pane_FronteiraMunicipal_15').style.zIndex = 415;
            map.getPane('pane_FronteiraMunicipal_15').style['mix-blend-mode'] = 'normal';
            var layer_FronteiraMunicipal_15 = new L.geoJson(json_FronteiraMunicipal_15, {
                attribution: '',
                interactive: false,
                dataVar: 'json_FronteiraMunicipal_15',
                layerName: 'layer_FronteiraMunicipal_15',
                pane: 'pane_FronteiraMunicipal_15',
                onEachFeature: pop_FronteiraMunicipal_15,
                style: style_FronteiraMunicipal_15_0,
            });
            bounds_group.addLayer(layer_FronteiraMunicipal_15);
            map.addLayer(layer_FronteiraMunicipal_15);

            // Controle de camadas
            var overlaysTree = [
                {label: '<b>Àreas Urbanas</b>',  selectAllCheckbox: true, children: [
                    {label: '<img src="legend/FronteiraMunicipal_15.png" /> Fronteira Municipal', layer: layer_FronteiraMunicipal_15},
                    {label: '<img src="legend/Capital_14.png" /> Capital', layer: layer_Capital_14},
                    {label: '<img src="legend/SedesMunicpios_13.png" /> Sedes Municípios', layer: layer_SedesMunicpios_13},]},
                {label: '<b>Malha Viária</b>',  selectAllCheckbox: true, children: [
                    {label: '<img src="legend/RodoviaFederal_12.png" /> Rodovia Federal', layer: layer_RodoviaFederal_12},
                    {label: '<img src="legend/RodoviaEstadual_11.png" /> Rodovia Estadual', layer: layer_RodoviaEstadual_11},]},
                {label: '<b>Quilombos</b>',  selectAllCheckbox: true, children: [
                    {label: '<img src="legend/QuilomboFederal_10.png" /> Quilombo Federal ', layer: layer_QuilomboFederal_10},
                    {label: '<img src="legend/QuilomboEstadual_9.png" /> Quilombo Estadual', layer: layer_QuilomboEstadual_9},]},
                {label: '<b>Terras Indigenas</b>',  selectAllCheckbox: true, children: [
                    {label: '<img src="legend/AldeiasIndigenas_8.png" /> Aldeias Indigenas', layer: cluster_AldeiasIndigenas_8},
                    {label: '<img src="legend/TerrasIndigenas_7.png" /> Terras Indigenas', layer: layer_TerrasIndigenas_7},]},
                {label: '<b>Unidade de Conservação</b>',  selectAllCheckbox: true, children: [
                    {label: '<img src="legend/reaMinlitar_6.png" /> Área Minlitar', layer: layer_reaMinlitar_6},
                    {label: '<img src="legend/UCFederal_5.png" /> U.C. Federal', layer: layer_UCFederal_5},
                    {label: '<img src="legend/UCEstadual_4.png" /> U.C. Estadual', layer: layer_UCEstadual_4},
                    {label: '<img src="legend/UCMunicipalMMA_3.png" /> U.C. Municipal / MMA', layer: layer_UCMunicipalMMA_3},]},
                {label: "OSM Standard", layer: layer_OSMStandard_2, radioGroup: 'bm' },
                {label: "OpenTopoMap", layer: layer_OpenTopoMap_1, radioGroup: 'bm' },
                {label: "OSM Hybrid", layer: layer_OSMHybrid_0, radioGroup: 'bm' },
            ];
            
            var lay = L.control.layers.tree(null, overlaysTree,{
                namedToggle: false,
                selectorBack: false,
                closedSymbol: '&#8862; &#x1f5c0;',
                openedSymbol: '&#8863; &#x1f5c1;',
                collapseAll: 'Collapse all',
                expandAll: 'Expand all',
                collapsed: true,
            });
            lay.addTo(map);
            setBounds();
            
            // Adicionar marcador para Belém (capital do Pará)
            L.marker([-1.4554, -48.5023])
                .addTo(map)
                .bindPopup('<strong>Belém</strong><br>Capital do Pará')
                .openPopup();
                
            return map;
        }

        // Inicializar o mapa quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            initializeQgis2webMap();
            
            // Inicializar funcionalidades do aplicativo de licenciamento
            initializeLicensingApp();
        });

        // Funções do aplicativo de licenciamento
        function initializeLicensingApp() {
            // [Todo o código JavaScript do aplicativo de licenciamento permanece aqui...]
            // Funções de conversão de coordenadas, upload de CSV, busca, etc.
            // ... (o código JavaScript permanece exatamente o mesmo da versão anterior)
            
            // Funções de conversão de coordenadas
            function gmsToDecimal(degrees, minutes, seconds, direction) {
                const decimal = Math.abs(degrees) + minutes / 60 + seconds / 3600;
                return direction * decimal;
            }
            
            function decimalToGms(decimal) {
                const absDecimal = Math.abs(decimal);
                const degrees = Math.floor(absDecimal);
                const minutes = Math.floor((absDecimal - degrees) * 60);
                const seconds = ((absDecimal - degrees - minutes / 60) * 3600).toFixed(3);
                
                return {
                    degrees: degrees,
                    minutes: minutes,
                    seconds: parseFloat(seconds),
                    direction: decimal >= 0 ? 1 : -1
                };
            }
            
            // Atualizar displays decimais
            function updateDecimalDisplays() {
                const latDeg = parseFloat(document.getElementById('lat-degrees').value) || 0;
                const latMin = parseFloat(document.getElementById('lat-minutes').value) || 0;
                const latSec = parseFloat(document.getElementById('lat-seconds').value) || 0;
                const latDir = parseFloat(document.getElementById('lat-direction').value);
                
                const lonDeg = parseFloat(document.getElementById('lon-degrees').value) || 0;
                const lonMin = parseFloat(document.getElementById('lon-minutes').value) || 0;
                const lonSec = parseFloat(document.getElementById('lon-seconds').value) || 0;
                const lonDir = parseFloat(document.getElementById('lon-direction').value);
                
                const latDecimal = gmsToDecimal(latDeg, latMin, latSec, latDir);
                const lonDecimal = gmsToDecimal(lonDeg, lonMin, lonSec, lonDir);
                
                document.getElementById('lat-decimal-display').textContent = `Decimal: ${latDecimal.toFixed(6)}°`;
                document.getElementById('lon-decimal-display').textContent = `Decimal: ${lonDecimal.toFixed(6)}°`;
                
                document.getElementById('latitude-decimal').value = latDecimal.toFixed(6);
                document.getElementById('longitude-decimal').value = lonDecimal.toFixed(6);
            }
            
            // Atualizar displays GMS a partir do decimal
            function updateGmsDisplays() {
                const latDecimal = parseFloat(document.getElementById('latitude-decimal').value) || 0;
                const lonDecimal = parseFloat(document.getElementById('longitude-decimal').value) || 0;
                
                const latGms = decimalToGms(latDecimal);
                const lonGms = decimalToGms(lonDecimal);
                
                document.getElementById('lat-degrees').value = latGms.degrees;
                document.getElementById('lat-minutes').value = latGms.minutes;
                document.getElementById('lat-seconds').value = latGms.seconds.toFixed(3);
                document.getElementById('lat-direction').value = latGms.direction;
                
                document.getElementById('lon-degrees').value = lonGms.degrees;
                document.getElementById('lon-minutes').value = lonGms.minutes;
                document.getElementById('lon-seconds').value = lonGms.seconds.toFixed(3);
                document.getElementById('lon-direction').value = lonGms.direction;
                
                updateDecimalDisplays();
            }
            
            // Configuração do toggle de formato
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const format = this.getAttribute('data-format');
                    
                    if (format === 'gms') {
                        document.getElementById('latitude-gms-group').style.display = 'block';
                        document.getElementById('longitude-gms-group').style.display = 'block';
                        document.getElementById('latitude-decimal-group').style.display = 'none';
                        document.getElementById('longitude-decimal-group').style.display = 'none';
                        updateGmsDisplays();
                    } else {
                        document.getElementById('latitude-gms-group').style.display = 'none';
                        document.getElementById('longitude-gms-group').style.display = 'none';
                        document.getElementById('latitude-decimal-group').style.display = 'block';
                        document.getElementById('longitude-decimal-group').style.display = 'block';
                        updateDecimalDisplays();
                    }
                });
            });
            
            // Configuração do toggle de tipo de busca
            document.querySelectorAll('.search-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.search-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const searchType = this.getAttribute('data-search-type');
                    
                    document.querySelectorAll('.search-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    document.getElementById(`${searchType}-search`).classList.add('active');
                });
            });
            
            // Event listeners para atualização automática
            document.querySelectorAll('#lat-degrees, #lat-minutes, #lat-seconds, #lat-direction, #lon-degrees, #lon-minutes, #lon-seconds, #lon-direction').forEach(input => {
                input.addEventListener('input', updateDecimalDisplays);
            });
            
            document.getElementById('latitude-decimal').addEventListener('input', updateGmsDisplays);
            document.getElementById('longitude-decimal').addEventListener('input', updateGmsDisplays);
            
            // Configuração do upload de arquivo CSV
            const fileUploadArea = document.getElementById('file-upload-area');
            const csvFileInput = document.getElementById('csv-file');
            const fileName = document.getElementById('file-name');
            
            fileUploadArea.addEventListener('click', () => {
                csvFileInput.click();
            });
            
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.style.background = '#e8f5e9';
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.style.background = '#f8fdf9';
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.style.background = '#f8fdf9';
                
                if (e.dataTransfer.files.length) {
                    csvFileInput.files = e.dataTransfer.files;
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
            
            csvFileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFileUpload(e.target.files[0]);
                }
            });
            
            function handleFileUpload(file) {
                if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                    alert('Por favor, selecione um arquivo CSV válido.');
                    return;
                }
                
                fileName.textContent = `Arquivo: ${file.name}`;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvText = e.target.result;
                    parseCSVData(csvText);
                };
                reader.readAsText(file, 'UTF-8');
            }
            
            function parseCSVData(csvText) {
                // Limpar marcadores anteriores
                markers.forEach(marker => map.removeLayer(marker.marker));
                markers = [];
                
                const lines = csvText.split('\n').filter(line => line.trim() !== '');
                if (lines.length === 0) {
                    alert('O arquivo CSV está vazio.');
                    return;
                }
                
                // Usar ponto e vírgula como separador
                const separator = ';';
                const headers = lines[0].split(separator).map(header => header.trim().toLowerCase());
                
                console.log('Headers detectados:', headers);
                
                empreendimentos = [];
                let linhasComErro = 0;
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    try {
                        const values = lines[i].split(separator).map(value => value.trim());
                        
                        const empreendimento = {};
                        
                        headers.forEach((header, index) => {
                            empreendimento[header] = values[index] || '';
                        });
                        
                        // Converter latitude e longitude para números
                        empreendimento.latitude = parseFloat(empreendimento.latitude.toString().replace(',', '.'));
                        empreendimento.longitude = parseFloat(empreendimento.longitude.toString().replace(',', '.'));
                        
                        console.log('Processando empreendimento:', empreendimento);
                        
                        // Só adicionar se as coordenadas são válidas
                        if (!isNaN(empreendimento.latitude) && !isNaN(empreendimento.longitude)) {
                            empreendimentos.push(empreendimento);
                            
                            // Adicionar marcador ao mapa
                            const marker = L.marker([empreendimento.latitude, empreendimento.longitude])
                                .addTo(map)
                                .bindPopup(`
                                    <strong>${empreendimento.empreendimento || 'N/A'}</strong><br>
                                    Processo: ${empreendimento.processo || 'N/A'}<br>
                                    Situação: ${empreendimento.situacao_processo || 'N/A'}<br>
                                    Título: ${empreendimento.titulo || 'N/A'}
                                `);
                            
                            markers.push({
                                marker: marker,
                                data: empreendimento
                            });
                            
                            console.log('Marcador adicionado:', empreendimento.latitude, empreendimento.longitude);
                        } else {
                            console.log('Coordenadas inválidas na linha:', i + 1, empreendimento);
                            linhasComErro++;
                        }
                    } catch (error) {
                        console.error(`Erro na linha ${i + 1}:`, error);
                        linhasComErro++;
                    }
                }
                
                console.log('Total de marcadores:', markers.length);
                
                // Ajustar a visualização do mapa para mostrar todos os marcadores
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers.map(m => m.marker));
                    map.fitBounds(group.getBounds().pad(0.1));
                    console.log('Mapa ajustado para mostrar marcadores');
                } else {
                    console.log('Nenhum marcador válido encontrado');
                }
                
                let mensagem = `${empreendimentos.length} empreendimentos carregados`;
                if (linhasComErro > 0) {
                    mensagem += ` (${linhasComErro} linhas com erro foram ignoradas)`;
                }
                
                document.getElementById('results-count').textContent = mensagem;
                
                // Preencher a tabela com todos os empreendimentos inicialmente
                updateResultsTable(empreendimentos);
            }
            
            // Função para calcular distância entre duas coordenadas (Haversine formula)
            function calcularDistancia(lat1, lon1, lat2, lon2) {
                const R = 6371; // Raio da Terra em km
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2); 
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                return R * c;
            }
            
            // Função para atualizar a tabela de resultados
            function updateResultsTable(resultados) {
                const tabela = document.getElementById('results-table');
                const contador = document.getElementById('results-count');
                
                tabela.innerHTML = '';
                contador.textContent = `${resultados.length} resultados`;
                
                if (resultados.length === 0) {
                    tabela.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum empreendimento encontrado.</td></tr>';
                } else {
                    resultados.forEach(emp => {
                        const statusClass = 
                            (emp.situacao_processo && emp.situacao_processo.includes('Licenciado')) || 
                            (emp.situacao_tit && emp.situacao_tit.includes('Vigente')) ? 'status-active' :
                            (emp.situacao_processo && emp.situacao_processo.includes('Suspenso')) || 
                            (emp.situacao_tit && emp.situacao_tit.includes('Vencida')) ? 'status-inactive' :
                            'status-pending';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${emp.empreendimento || 'N/A'}</td>
                            <td>${emp.processo || 'N/A'}</td>
                            <td><span class="status-badge ${statusClass}">${emp.situacao_processo || 'N/A'}</span></td>
                            <td>${emp.localizacao || emp.Localizacao || 'N/A'}</td>
                            <td>${emp.titulo || 'N/A'}</td>
                            <td>${emp.distancia ? emp.distancia.toFixed(2) + ' km' : 'N/A'}</td>
                        `;
                        
                        // Adicionar evento de clique para focar no marcador
                        if (emp.latitude && emp.longitude) {
                            row.style.cursor = 'pointer';
                            row.addEventListener('click', () => {
                                map.setView([emp.latitude, emp.longitude], 10);
                                const markerObj = markers.find(m => m.data === emp);
                                if (markerObj) {
                                    markerObj.marker.openPopup();
                                }
                            });
                        }
                        
                        tabela.appendChild(row);
                    });
                }
            }
            
            // Função para obter coordenadas decimais atuais
            function getCurrentCoordinates() {
                const format = document.querySelector('.format-btn.active').getAttribute('data-format');
                
                if (format === 'gms') {
                    const latDeg = parseFloat(document.getElementById('lat-degrees').value) || 0;
                    const latMin = parseFloat(document.getElementById('lat-minutes').value) || 0;
                    const latSec = parseFloat(document.getElementById('lat-seconds').value) || 0;
                    const latDir = parseFloat(document.getElementById('lat-direction').value);
                    
                    const lonDeg = parseFloat(document.getElementById('lon-degrees').value) || 0;
                    const lonMin = parseFloat(document.getElementById('lon-minutes').value) || 0;
                    const lonSec = parseFloat(document.getElementById('lon-seconds').value) || 0;
                    const lonDir = parseFloat(document.getElementById('lon-direction').value);
                    
                    return {
                        latitude: gmsToDecimal(latDeg, latMin, latSec, latDir),
                        longitude: gmsToDecimal(lonDeg, lonMin, lonSec, lonDir)
                    };
                } else {
                    return {
                        latitude: parseFloat(document.getElementById('latitude-decimal').value) || 0,
                        longitude: parseFloat(document.getElementById('longitude-decimal').value) || 0
                    };
                }
            }
            
            // Função para buscar por coordenadas
            function buscarPorCoordenadas() {
                if (empreendimentos.length === 0) {
                    alert('Por favor, carregue um arquivo CSV primeiro.');
                    return;
                }
                
                const coords = getCurrentCoordinates();
                const latitude = coords.latitude;
                const longitude = coords.longitude;
                const radius = parseFloat(document.getElementById('radius').value);
                
                if (isNaN(latitude) || isNaN(longitude) || isNaN(radius)) {
                    alert("Por favor, insira coordenadas e raio válidos.");
                    return;
                }
                
                // Limpar círculo de busca anterior, se existir
                if (window.searchCircle) {
                    map.removeLayer(window.searchCircle);
                }
                
                // Adicionar círculo de busca
                window.searchCircle = L.circle([latitude, longitude], {
                    color: '#3498db',
                    fillColor: '#3498db',
                    fillOpacity: 0.2,
                    radius: radius * 1000
                }).addTo(map);
                
                // Adicionar marcador para a coordenada de busca
                if (window.searchMarker) {
                    map.removeLayer(window.searchMarker);
                }
                
                window.searchMarker = L.marker([latitude, longitude])
                    .addTo(map)
                    .bindPopup('Coordenada de Busca')
                    .openPopup();
                
                // Ajustar o zoom do mapa para mostrar a área de busca
                map.fitBounds(window.searchCircle.getBounds());
                
                // Filtrar empreendimentos dentro do raio
                const resultados = [];
                markers.forEach(markerObj => {
                    const distancia = calcularDistancia(
                        latitude, longitude,
                        markerObj.data.latitude, markerObj.data.longitude
                    );
                    
                    markerObj.distancia = distancia;
                    
                    if (distancia <= radius) {
                        resultados.push({
                            ...markerObj.data,
                            distancia: distancia
                        });
                        
                        // Alterar a cor do marcador para verde
                        markerObj.marker.setIcon(
                            L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        );
                    } else {
                        // Alterar a cor do marcador para vermelho
                        markerObj.marker.setIcon(
                            L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        );
                    }
                });
                
                // Exibir resultados na tabela
                updateResultsTable(resultados);
            }
            
            // Função para buscar por processo
            function buscarPorProcesso() {
                if (empreendimentos.length === 0) {
                    alert('Por favor, carregue um arquivo CSV primeiro.');
                    return;
                }
                
                const processNumber = document.getElementById('process-number').value.trim();
                
                if (!processNumber) {
                    alert('Por favor, insira um número de processo.');
                    return;
                }
                
                // Limpar elementos de busca anteriores
                if (window.searchCircle) {
                    map.removeLayer(window.searchCircle);
                }
                if (window.searchMarker) {
                    map.removeLayer(window.searchMarker);
                }
                
                // Buscar empreendimento pelo número do processo
                const resultados = [];
                let encontrado = false;
                
                markers.forEach(markerObj => {
                    const processo = markerObj.data.processo || '';
                    
                    if (processo.toLowerCase().includes(processNumber.toLowerCase())) {
                        resultados.push(markerObj.data);
                        encontrado = true;
                        
                        // Destacar o marcador encontrado em verde
                        markerObj.marker.setIcon(
                            L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        );
                        
                        // Centralizar o mapa no empreendimento encontrado
                        map.setView([markerObj.data.latitude, markerObj.data.longitude], 10);
                        markerObj.marker.openPopup();
                    } else {
                        // Deixar outros marcadores em vermelho
                        markerObj.marker.setIcon(
                            L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        );
                    }
                });
                
                if (!encontrado) {
                    alert('Nenhum empreendimento encontrado com o número de processo informado.');
                }
                
                // Exibir resultados na tabela
                updateResultsTable(resultados);
            }
            
            // Função para mostrar todos os empreendimentos
            function mostrarTodos() {
                if (empreendimentos.length === 0) {
                    alert('Por favor, carregue um arquivo CSV primeiro.');
                    return;
                }
                
                // Limpar elementos de busca anteriores
                if (window.searchCircle) {
                    map.removeLayer(window.searchCircle);
                }
                if (window.searchMarker) {
                    map.removeLayer(window.searchMarker);
                }
                
                // Resetar todos os marcadores para a cor padrão
                markers.forEach(markerObj => {
                    markerObj.marker.setIcon(
                        L.icon({
                            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                            iconSize: [25, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [1, -34],
                            shadowSize: [41, 41]
                        })
                    );
                });
                
                // Ajustar a visualização do mapa para mostrar todos os marcadores
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers.map(m => m.marker));
                    map.fitBounds(group.getBounds().pad(0.1));
                }
                
                // Exibir todos os empreendimentos na tabela
                updateResultsTable(empreendimentos);
            }
            
            // Adicionar eventos aos botões
            document.getElementById('search-coordinates-btn').addEventListener('click', buscarPorCoordenadas);
            document.getElementById('search-process-btn').addEventListener('click', buscarPorProcesso);
            document.getElementById('show-all-btn').addEventListener('click', mostrarTodos);
            
            // Inicializar displays
            updateDecimalDisplays();
            
            // Adicionar alguns empreendimentos de exemplo (caso o usuário não carregue um CSV)
            const exemploCSV = `empreendimento;processo;situacao_processo;Localizacao;nome_titulo;titulo;situacao_tit;latitude;longitude
Usina Hidrelétrica Belo Monte;2022/0000009426;Licenciado;Altamira;Licença de Operação;LO 9876;Vigente;-3.1276;-52.0217
Mineração de Bauxita;2023/0000001234;Em análise;Paragominas;Licença Prévia;LP 5432;Em análise;-3.0026;-47.3527
Projeto de Reflorestamento;2021/0000005678;Suspenso;Santarém;Licença de Instalação;LI 1234;Suspensa;-2.4431;-54.7079
Termelétrica a Gás;2022/0000009012;Licenciado;Marabá;Licença de Operação;LO 5678;Vigente;-5.3689;-49.1178
Frigorífico Bovino;2023/0000003456;Em operação;Redenção;Licença de Operação;LO 8765;Vencida;-8.0253;-50.0314`;
            
            // Parse do exemplo automaticamente
            parseCSVData(exemploCSV);
            fileName.textContent = "Arquivo: exemplo_para.csv (carregado automaticamente)";
        }
    </script>
</body>
</html>
